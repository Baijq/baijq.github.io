<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>缓存-Redis | BiuBiu</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/note/notebook.png">
    <meta name="description" content="让坚持成为品质，让优秀成为习惯">
    
    <link rel="preload" href="/note/assets/css/0.styles.ba1ec7e7.css" as="style"><link rel="preload" href="/note/assets/js/app.44a37a57.js" as="script"><link rel="preload" href="/note/assets/js/2.4f793508.js" as="script"><link rel="preload" href="/note/assets/js/105.64e0413b.js" as="script"><link rel="prefetch" href="/note/assets/js/10.a69b22ac.js"><link rel="prefetch" href="/note/assets/js/100.ef8951f5.js"><link rel="prefetch" href="/note/assets/js/101.0815870f.js"><link rel="prefetch" href="/note/assets/js/102.d5bf036f.js"><link rel="prefetch" href="/note/assets/js/103.03733dae.js"><link rel="prefetch" href="/note/assets/js/104.b48ab59a.js"><link rel="prefetch" href="/note/assets/js/106.d7a0aaba.js"><link rel="prefetch" href="/note/assets/js/107.615e2232.js"><link rel="prefetch" href="/note/assets/js/108.60de7aea.js"><link rel="prefetch" href="/note/assets/js/109.0ff662c4.js"><link rel="prefetch" href="/note/assets/js/11.3135b4bb.js"><link rel="prefetch" href="/note/assets/js/12.9523f11a.js"><link rel="prefetch" href="/note/assets/js/13.0309a5a0.js"><link rel="prefetch" href="/note/assets/js/14.5b8a0f9d.js"><link rel="prefetch" href="/note/assets/js/15.0df26129.js"><link rel="prefetch" href="/note/assets/js/16.8489bbd9.js"><link rel="prefetch" href="/note/assets/js/17.1de86398.js"><link rel="prefetch" href="/note/assets/js/18.928f690e.js"><link rel="prefetch" href="/note/assets/js/19.c57fe25c.js"><link rel="prefetch" href="/note/assets/js/20.643249af.js"><link rel="prefetch" href="/note/assets/js/21.00990df2.js"><link rel="prefetch" href="/note/assets/js/22.b024fff9.js"><link rel="prefetch" href="/note/assets/js/23.d44875d5.js"><link rel="prefetch" href="/note/assets/js/24.69f9067a.js"><link rel="prefetch" href="/note/assets/js/25.9fda1632.js"><link rel="prefetch" href="/note/assets/js/26.13e1eb02.js"><link rel="prefetch" href="/note/assets/js/27.8283ad31.js"><link rel="prefetch" href="/note/assets/js/28.0036575c.js"><link rel="prefetch" href="/note/assets/js/29.f403e244.js"><link rel="prefetch" href="/note/assets/js/3.f70dd677.js"><link rel="prefetch" href="/note/assets/js/30.082edf3b.js"><link rel="prefetch" href="/note/assets/js/31.ffb5c280.js"><link rel="prefetch" href="/note/assets/js/32.150fe311.js"><link rel="prefetch" href="/note/assets/js/33.9ff78b90.js"><link rel="prefetch" href="/note/assets/js/34.2ff7b4f1.js"><link rel="prefetch" href="/note/assets/js/35.a1010145.js"><link rel="prefetch" href="/note/assets/js/36.1b9b969b.js"><link rel="prefetch" href="/note/assets/js/37.70b84525.js"><link rel="prefetch" href="/note/assets/js/38.7c864371.js"><link rel="prefetch" href="/note/assets/js/39.5def1a6d.js"><link rel="prefetch" href="/note/assets/js/4.35addd36.js"><link rel="prefetch" href="/note/assets/js/40.a5017a00.js"><link rel="prefetch" href="/note/assets/js/41.bfc3d865.js"><link rel="prefetch" href="/note/assets/js/42.e5da9424.js"><link rel="prefetch" href="/note/assets/js/43.988b7db7.js"><link rel="prefetch" href="/note/assets/js/44.ae7a6473.js"><link rel="prefetch" href="/note/assets/js/45.8c147733.js"><link rel="prefetch" href="/note/assets/js/46.9830ea26.js"><link rel="prefetch" href="/note/assets/js/47.09de20d9.js"><link rel="prefetch" href="/note/assets/js/48.590daf77.js"><link rel="prefetch" href="/note/assets/js/49.e25ac5bf.js"><link rel="prefetch" href="/note/assets/js/5.ffc87443.js"><link rel="prefetch" href="/note/assets/js/50.863ceb41.js"><link rel="prefetch" href="/note/assets/js/51.2de1f9cd.js"><link rel="prefetch" href="/note/assets/js/52.d95ebd22.js"><link rel="prefetch" href="/note/assets/js/53.6675e128.js"><link rel="prefetch" href="/note/assets/js/54.5c36fd50.js"><link rel="prefetch" href="/note/assets/js/55.9e1d55d2.js"><link rel="prefetch" href="/note/assets/js/56.9848c7bd.js"><link rel="prefetch" href="/note/assets/js/57.3bf46602.js"><link rel="prefetch" href="/note/assets/js/58.2afcdb38.js"><link rel="prefetch" href="/note/assets/js/59.f2e387d8.js"><link rel="prefetch" href="/note/assets/js/6.5bff1b90.js"><link rel="prefetch" href="/note/assets/js/60.ccabf58e.js"><link rel="prefetch" href="/note/assets/js/61.38d2f45e.js"><link rel="prefetch" href="/note/assets/js/62.a9193e47.js"><link rel="prefetch" href="/note/assets/js/63.fce76476.js"><link rel="prefetch" href="/note/assets/js/64.0d9ebc70.js"><link rel="prefetch" href="/note/assets/js/65.9babb434.js"><link rel="prefetch" href="/note/assets/js/66.f0f8e800.js"><link rel="prefetch" href="/note/assets/js/67.146d9084.js"><link rel="prefetch" href="/note/assets/js/68.113b847f.js"><link rel="prefetch" href="/note/assets/js/69.ba7af142.js"><link rel="prefetch" href="/note/assets/js/7.4b0fb8dd.js"><link rel="prefetch" href="/note/assets/js/70.81607f02.js"><link rel="prefetch" href="/note/assets/js/71.ce07d8f6.js"><link rel="prefetch" href="/note/assets/js/72.f8aaa1bd.js"><link rel="prefetch" href="/note/assets/js/73.c4ba25aa.js"><link rel="prefetch" href="/note/assets/js/74.cee276c6.js"><link rel="prefetch" href="/note/assets/js/75.ec79ad3f.js"><link rel="prefetch" href="/note/assets/js/76.0d9e3770.js"><link rel="prefetch" href="/note/assets/js/77.bfc559a2.js"><link rel="prefetch" href="/note/assets/js/78.393131a7.js"><link rel="prefetch" href="/note/assets/js/79.1d3e47b2.js"><link rel="prefetch" href="/note/assets/js/8.1aba4d1c.js"><link rel="prefetch" href="/note/assets/js/80.da33f02f.js"><link rel="prefetch" href="/note/assets/js/81.5beb8cef.js"><link rel="prefetch" href="/note/assets/js/82.6d47a32e.js"><link rel="prefetch" href="/note/assets/js/83.3f47f652.js"><link rel="prefetch" href="/note/assets/js/84.47521f70.js"><link rel="prefetch" href="/note/assets/js/85.0764ced9.js"><link rel="prefetch" href="/note/assets/js/86.1cae9fe7.js"><link rel="prefetch" href="/note/assets/js/87.165e0b60.js"><link rel="prefetch" href="/note/assets/js/88.27c12c66.js"><link rel="prefetch" href="/note/assets/js/89.34b90569.js"><link rel="prefetch" href="/note/assets/js/9.27c0ee57.js"><link rel="prefetch" href="/note/assets/js/90.0b511fce.js"><link rel="prefetch" href="/note/assets/js/91.e004778f.js"><link rel="prefetch" href="/note/assets/js/92.9f0faf71.js"><link rel="prefetch" href="/note/assets/js/93.59f3ddd5.js"><link rel="prefetch" href="/note/assets/js/94.a639765b.js"><link rel="prefetch" href="/note/assets/js/95.59647244.js"><link rel="prefetch" href="/note/assets/js/96.98ff48f7.js"><link rel="prefetch" href="/note/assets/js/97.080d2c3e.js"><link rel="prefetch" href="/note/assets/js/98.5451d23f.js"><link rel="prefetch" href="/note/assets/js/99.6e2c4470.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ba1ec7e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">BiuBiu</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/core/springboot/" class="nav-link router-link-active">
  SpringBoot
</a></div><div class="nav-item"><a href="/note/core/note/" class="nav-link">
  学习笔记
</a></div><div class="nav-item"><a href="/note/core/my/" class="nav-link">
  随心所欲
</a></div><div class="nav-item"><a href="/note/core/about/" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/note/core/springboot/" class="nav-link router-link-active">
  SpringBoot
</a></div><div class="nav-item"><a href="/note/core/note/" class="nav-link">
  学习笔记
</a></div><div class="nav-item"><a href="/note/core/my/" class="nav-link">
  随心所欲
</a></div><div class="nav-item"><a href="/note/core/about/" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>SpringBoot</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/core/springboot/springboot-01.html" class="sidebar-link">Web入门篇</a></li><li><a href="/note/core/springboot/springboot-02.html" class="sidebar-link">整合MyBatis</a></li><li><a href="/note/core/springboot/springboot-03.html" class="sidebar-link">基础信息封装</a></li><li><a href="/note/core/springboot/springboot-04.html" class="sidebar-link">整合 MyBatis-Plus</a></li><li><a href="/note/core/springboot/springboot-05.html" class="sidebar-link">多数据源切换</a></li><li><a href="/note/core/springboot/springboot-06.html" aria-current="page" class="active sidebar-link">缓存-Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/core/springboot/springboot-06.html#简单使用" class="sidebar-link">简单使用</a></li><li class="sidebar-sub-header"><a href="/note/core/springboot/springboot-06.html#springcache介绍" class="sidebar-link">SpringCache介绍</a></li></ul></li><li><a href="/note/core/springboot/springboot-07.html" class="sidebar-link">整合日志Logback</a></li><li><a href="/note/core/springboot/springboot-08.html" class="sidebar-link">配置文件</a></li><li><a href="/note/core/springboot/springboot-09.html" class="sidebar-link">整合定时任务</a></li><li><a href="/note/core/springboot/springboot.html" class="sidebar-link">SpringBoot</a></li><li><a href="/note/core/springboot/boot-demo.html" class="sidebar-link">SpringBoot代码段</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>微服务</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/core/springboot/cloud/springcloud组件介绍.html" class="sidebar-link">SpringCloud 各组件</a></li><li><a href="/note/core/springboot/cloud/springcloudalibaba.html" class="sidebar-link">SpringCloudAlibaba</a></li><li><a href="/note/core/springboot/cloud/Dubbo介绍.html" class="sidebar-link">Dubbo 框架(RPC)</a></li><li><a href="/note/core/springboot/cloud/Apollo介绍.html" class="sidebar-link">Apollo</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="缓存-redis"><a href="#缓存-redis" class="header-anchor">#</a> 缓存-Redis</h1> <h2 id="简单使用"><a href="#简单使用" class="header-anchor">#</a> 简单使用</h2> <h3 id="准备一个项目"><a href="#准备一个项目" class="header-anchor">#</a> 准备一个项目</h3> <p>快速构建一个web项目，实现CURD功能 SpringBoot+MyBatis-Plus+MySQL</p> <ol><li>数据准备,建一个表<code>biubiu.t_user</code></li></ol> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> t_user<span class="token punctuation">(</span>
	id <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">auto_increment</span> <span class="token keyword">comment</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
  user_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">comment</span> <span class="token string">'用户名称'</span><span class="token punctuation">,</span>
  pass_word <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span> <span class="token keyword">comment</span> <span class="token string">'用户密码'</span><span class="token punctuation">,</span>
  sex <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
  birthday  <span class="token keyword">datetime</span>  <span class="token keyword">comment</span> <span class="token string">'生日'</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span> <span class="token keyword">auto_increment</span> <span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">comment</span> <span class="token string">'用户表'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对应的Entity</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">&quot;t_user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span><span class="token string">&quot;user_name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> sex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>

    <span class="token comment">//setter and  getter method</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="2"><li>使用单元测试插入两条测试数据</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;biubiu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="整合-redis"><a href="#整合-redis" class="header-anchor">#</a> 整合-Redis</h3> <ol><li>导包</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>配置</li></ol> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment">## Redis 配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token comment">## Redis数据库索引（默认为0）</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment">## Redis服务器地址</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.126.129
    <span class="token comment">## Redis服务器连接端口</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token comment">## Redis服务器连接密码（默认为空）</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
    <span class="token key atrule">jedis</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment">## 连接池最大连接数（使用负值表示没有限制）</span>
        <span class="token comment">#spring.redis.pool.max-active=8</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment">## 连接池最大阻塞等待时间（使用负值表示没有限制）</span>
        <span class="token comment">#spring.redis.pool.max-wait=-1</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
        <span class="token comment">## 连接池中的最大空闲连接</span>
        <span class="token comment">#spring.redis.pool.max-idle=8</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment">## 连接池中的最小空闲连接</span>
        <span class="token comment">#spring.redis.pool.min-idle=0</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment">## 连接超时时间（毫秒）</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1200</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ol start="3"><li>配置类</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 自定义的redisTemplate 注入到Spring容器
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 1. Jackson</span>
        <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> jacksonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); 过期了，用下面的替代</span>
        om<span class="token punctuation">.</span><span class="token function">activateDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">LaissezFaireSubTypeValidator</span><span class="token punctuation">.</span>instance<span class="token punctuation">,</span> <span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">,</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>As</span><span class="token punctuation">.</span>PROPERTY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jacksonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. String</span>
        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//key-采用String的序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//hash的key-采用String的序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//value-采用jackson序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jacksonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//hash的value-采用jackson的序列化方式</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jacksonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><ol start="4"><li>Redis封装工具</li></ol> <p>在使用 <code>redisTemplate</code> 工具得时候，还是有点麻烦，比如 <code>redisTemplate.opsForValue().set(...)</code> 还是比较麻烦，所以我们自己封装了一个工具类使用！</p> <p><a href="/note/core/note/java/code/redis-util.html">RedisUtils.java</a></p> <ol start="5"><li>简单使用</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisUtils</span> redisUtils<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        redisUtils<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisUtils<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="请求流程"><a href="#请求流程" class="header-anchor">#</a> 请求流程</h3> <p><img src="https://s4.ax1x.com/2022/02/21/HvAdw4.png" alt="HvAdw4.png"></p> <ol><li>请求过来先查Redis</li> <li>缓存没有的话，去查DB；缓存有，直接返回缓存的</li> <li>DB查到后刷新到缓存</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisUtils</span> redisUtils<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1. 先从Redis查询用户列表</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;读取Redis缓存&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> userListJson <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisUtils<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userListCache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userListJson <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Redis没有，读取DB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//DB有数据，刷新缓存</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>users <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisUtils<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;userListCache&quot;</span><span class="token punctuation">,</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> users<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;从redis缓存取值&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">parseArray</span><span class="token punctuation">(</span>userListJson<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="springcache介绍"><a href="#springcache介绍" class="header-anchor">#</a> SpringCache介绍</h2> <p>在SpringBoot中, 数据的缓存管理存储依赖于Spring框架中cache相关的 <code>org.springframework.cache.Cache</code> 和 <code>org.springframework.cache.CacheManager</code> 缓存管理器接口</p> <p>如果程序中没有定义类型为CacheManager的Bean组件或者是名为cacheResolver的CacheResolver缓存解析器，SpringBoot将尝试选择并启用以下缓存组件（按照指定的顺序）</p> <p>-（1）Generic</p> <p>-（2）JCache (JSR-107)(EhCache 3、Hazelcast、Infinispan等)</p> <p>-（3）EhCache 2.x</p> <p>-（4）Hazelcast</p> <p>-（5）Infinispan</p> <p>-（6）Couchbase</p> <p>-（7）Redis</p> <p>-（8）Caffeine</p> <p>-（9）Simple</p> <p>在项目中添加某个缓存管理组件（例如Redis）后，Spring Boot项目会选择并启用对应的缓存管理器。如果项目中同时添加了多个缓存组件，且没有指定缓存管理器或者缓存解析器（CacheManager或者cacheResolver），那么Spring Boot会按照上述顺序在添加的多个缓存中优先启用指定的缓存组件进行缓存管理</p> <p>Spring Boot默认缓存管理中，没有添加任何缓存管理组件能实现缓存管理。这是因为开启缓存管理后，Spring Boot会按照上述列表顺序查找有效的缓存组件进行缓存管理，如果没有任何缓存组件，会默认使用最后一个Simple缓存组件进行管理。Simple缓存组件是Spring Boot默认的缓存管理组件，它默认使用内存中的ConcurrentMap进行缓存存储，所以在没有添加任何第三方缓存组件的情况下，可以实现内存中的缓存管理，但是我们不推荐使用这种缓存管理方式</p> <p>当在Spring Boot默认缓存管理的基础上引入Redis缓存组件，即在pom.xml文件中添加Spring Data Redis依赖启动器后，SpringBoot会使用RedisCacheConfigratioin当做生效的自动配置类进行缓存相关的自动装配，容器中使用的缓存管理器是RedisCacheManager, 这个缓存管理器创建的Cache为 RedisCache, 进而操控redis进行数据的缓存</p> <h3 id="注解"><a href="#注解" class="header-anchor">#</a> 注解</h3> <p>SpringCache 提供了 <code>@Cacheable</code> 、<code>@CachePut</code> 、<code>@CacheEvict</code> 、<code>@Caching</code> 等注解，在方法上使用</p> <ol><li><code>@EnableCaching</code></li></ol> <p>开启缓存功能，一般放在启动类上或者自定义的RedisConfig配置类上</p> <ol start="2"><li><code>@CacheConfig</code></li></ol> <p>当我们需要缓存的地方越来越多，可以使用 <code>@CacheConfig(cacheNames = &quot;cacheName&quot;)</code> 注解在 class 之上来统一指定value的值，统一管理keys，这时可省略value，如果你在你的方法依旧写上了value，那么依然以方法的value值为准。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token annotation punctuation">@CacheConfig</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;categories&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CategoryServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">CategoryService</span> <span class="token punctuation">{</span>
    <span class="token comment">//TODO</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li><code>@Cacheable</code></li></ol> <p>根据方法对其返回结果进行缓存，下次请求时，如果缓存存在，则直接读取缓存数据返回；如果缓存不存在，则执行方法，并把返回的结果存入缓存中。一般用在查询方法上。</p> <ol start="4"><li><code>@CachePut</code></li></ol> <p>使用该注解标志的方法，每次都会执行，并将结果存入指定的缓存中。其他方法可以直接从响应的缓存中读取缓存数据，而不需要再去查询数据库。一般用在新增方法上</p> <ol start="5"><li><code>@CacheEvict</code></li></ol> <p>使用该注解标志的方法，会清空指定的缓存。一般用在更新或者删除方法上</p> <ol start="6"><li><code>@Caching</code></li></ol> <p>该注解可以实现同一个方法上同时使用多种注解</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/note/core/springboot/springboot-05.html" class="prev">
        多数据源切换
      </a></span> <span class="next"><a href="/note/core/springboot/springboot-07.html">
        整合日志Logback
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.44a37a57.js" defer></script><script src="/note/assets/js/2.4f793508.js" defer></script><script src="/note/assets/js/105.64e0413b.js" defer></script>
  </body>
</html>
