(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{483:function(n,s,a){"use strict";a.r(s);var t=a(62),e=Object(t.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("p",[n._v("Linux Centos7")]),n._v(" "),a("h2",{attrs:{id:"一、安装jdk和maven"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装jdk和maven"}},[n._v("#")]),n._v(" 一、安装JDK和Maven")]),n._v(" "),a("h3",{attrs:{id:"_1-准备工作-下载必要安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备工作-下载必要安装包"}},[n._v("#")]),n._v(" 1. 准备工作，下载必要安装包")]),n._v(" "),a("ol",[a("li",[n._v("jdk-8u181-linux-x64.tar.gz")]),n._v(" "),a("li",[n._v("apache-maven-3.8.6-bin.tar.gz")])]),n._v(" "),a("h3",{attrs:{id:"_2-步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-步骤"}},[n._v("#")]),n._v(" 2. 步骤")]),n._v(" "),a("ol",[a("li",[n._v("创建目录\nmkdir -p /opt/app /opt/software")])]),n._v(" "),a("ul",[a("li",[n._v("/opt/app 存放安装包")]),n._v(" "),a("li",[n._v("/opt/software 存放解压后的")])]),n._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[n._v("上传安装包到 /opt/app下")])]),n._v(" "),a("li",[a("p",[n._v("解压\ntar -xvzf jdk-8u181-linux-x64.tar.gz -C /opt/software\ntar -xvzf apache-maven-3.8.6-bin.tar.gz -C /opt/software")])]),n._v(" "),a("li",[a("p",[n._v("配置maven\n创建仓库本地仓库 /opt/software/apache-maven-3.8.6/ck\n配置阿里云仓库")])]),n._v(" "),a("li",[a("p",[n._v("配置jdk,maven环境变量\nvi /etc/profile\nsource /etc/profile")])])]),n._v(" "),a("h1",{attrs:{id:"maven-environment-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maven-environment-config"}},[n._v("#")]),n._v(" Maven Environment Config")]),n._v(" "),a("p",[n._v("export M2_HOME=/opt/software/apache-maven-3.8.6\nexport PATH=$PATH:$JAVA_HOME/bin:$M2_HOME/bin")]),n._v(" "),a("h1",{attrs:{id:"java-environment-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-environment-config"}},[n._v("#")]),n._v(" Java Environment Config")]),n._v(" "),a("p",[n._v("export JAVA_HOME=/opt/software/jdk1.8.0_181\nexport JRE_HOME=${JAVA_HOME}/jre\nexport CLASSPATH=.😒{JAVA_HOME}/lib:${JRE_HOME}/lib\nexport PATH=${JAVA_HOME}/bin:$PATH")]),n._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[n._v("验证\njava -version\nmvn -v")])]),n._v(" "),a("h2",{attrs:{id:"二、docker部署jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、docker部署jenkins"}},[n._v("#")]),n._v(" 二、Docker部署Jenkins")]),n._v(" "),a("ol",[a("li",[a("p",[n._v("启动容器\ndocker run -di "),a("br"),n._v("\n--name=jenkins "),a("br"),n._v("\n-p 8080:8080 "),a("br"),n._v("\n-v /root/jenkins_home/:/var/jenkins_home "),a("br"),n._v("\n-v /opt/software/jdk1.8.0_181:/opt/software/jdk1.8.0_181 "),a("br"),n._v("\n-v /opt/software/apache-maven-3.8.6:/opt/software/apache-maven-3.8.6 "),a("br"),n._v("\n-v $(which docker):/usr/bin/docker "),a("br"),n._v("\n-v /var/run/docker.sock:/var/run/docker.sock "),a("br"),n._v("\njenkins/jenkins:lts")])]),n._v(" "),a("li",[a("p",[n._v("进入页面\nhttp://192.168.198.128:8080\ndocker logs jenkins 可以看到密码，输入密码 103031818d754c2897739d6010c0448d\n安装推荐的插件\n创建第一个管理员用户，一路保存完成即可\n开始使用Jenkins")])]),n._v(" "),a("li",[a("p",[n._v("插件配置\nManage Jekins > 插件管理 可选插件 搜索即可")])]),n._v(" "),a("li",[a("p",[n._v("安装SSH插件\ndocker restart jenkins 重启jenkins")])]),n._v(" "),a("li",[a("p",[n._v("添加ssh登录账号凭据\n系统管理 > Manage Credentials > Stores scoped to Jenkins 点全局 添加凭据 输入用户名、密码、ID、描述（Linux服务器账号密码）")])]),n._v(" "),a("li",[a("p",[n._v("配置全局SSH\n系统管理 > 系统配置 >  SSH remote hosts 点击新增 输入 Hostname Port=22 选择 Credentials=我们刚新增的linux服务器账号密码 点击保存")])]),n._v(" "),a("li",[a("p",[n._v("配置jdk和maven （我们-v挂载过）这里需要的是Docekr里的路径\n点击系统管理，找到全局工具配置\njdk1.8         /opt/software/jdk1.8.0_181\nmaven3.8.6     /opt/software/apache-maven-3.8.6")])])]),n._v(" "),a("h2",{attrs:{id:"三、准备springboot项目到git"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、准备springboot项目到git"}},[n._v("#")]),n._v(" 三、准备Springboot项目到git")]),n._v(" "),a("p",[n._v("https://gitee.com/baijq/jenkins-test.git")]),n._v(" "),a("h2",{attrs:{id:"四、使用jenkins部署项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、使用jenkins部署项目"}},[n._v("#")]),n._v(" 四、使用Jenkins部署项目")]),n._v(" "),a("ol",[a("li",[n._v("新建任务 创建一个自由风格项目")]),n._v(" "),a("li",[n._v("添加git凭据 url Credentials(和添加服务器账号一样)")]),n._v(" "),a("li",[n._v("Build Steps 选择调用顶层Maven  Maven 版本选择我们配置的那个  目标=clean package  POM=pom.xml(点击高级出现)")]),n._v(" "),a("li",[n._v("增加构建执行shell")])]),n._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[n._v("#!/bin/bash")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 服务名称")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n._v("SERVER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("jenkins\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 源jar名称，mvn打包之后，target目录下的jar包名称")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n._v("JAR_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("demo-0.0.1-SNAPSHOT\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# jenkins下的目录")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n._v("JENKINS_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[n._v("=")]),n._v("/var/jenkins_home/workspace/jenkins\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 等待三秒")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("sleep")]),n._v(" 3s\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("sleep")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("sleep")]),n._v(" 2s\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("sleep")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("sleep")]),n._v(" 1s\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("sleep")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[n._v("1")]),n._v("\n      \n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"结束进程完成"')]),n._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("cd")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$JENKINS_HOME")]),n._v("/target\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("cp")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$JENKINS_HOME")]),n._v("/Dockerfile "),a("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$JENKINS_HOME")]),n._v("/target\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 修改文件权限")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("chmod")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[n._v("755")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[n._v("$JAR_NAME")]),n._v(".jar\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"看看docker能不能用"')]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("docker")]),n._v(" -v\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"停止容器"')]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 停止容器")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("docker")]),n._v(" stop springboot\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"删除容器"')]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 删除容器")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("docker")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("rm")]),n._v(" springboot\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"删除镜像"')]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 删除镜像")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("docker")]),n._v(" rmi springboot\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"打包镜像"')]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 打包镜像")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("docker")]),n._v(" build -t springboot "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v(".")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[n._v("echo")]),n._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[n._v('"运行镜像"')]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 运行镜像")]),n._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[n._v("docker")]),n._v(" run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[n._v("8081")]),n._v(":8081 --name springboot springboot\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[n._v("立即构建 可以查看控制台")])]),n._v(" "),a("h3",{attrs:{id:"报错信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#报错信息"}},[n._v("#")]),n._v(" 报错信息")]),n._v(" "),a("p",[n._v("[INFO] Scanning for projects...\nDownloading from aliyunmaven: https://maven.aliyun.com/repository/public/org/springframework/boot/spring-boot-starter-parent/2.3.2.RELEASE/spring-boot-starter-parent-2.3.2.RELEASE.pom\n[WARNING] Failed to create parent directories for tracking file /opt/software/apache-maven-3.8.6/ck/org/springframework/boot/spring-boot-starter-parent/2.3.2.RELEASE/spring-boot-starter-parent-2.3.2.RELEASE.pom.lastUpdated\n[ERROR] [ERROR] Some problems were encountered while processing the POMs:\n[FATAL] Non-resolvable parent POM for com.example:jenkins-test:0.0.1-SNAPSHOT: Could not transfer artifact org.springframework.boot:spring-boot-starter-parent:pom:2.3.2.RELEASE from/to aliyunmaven (https://maven.aliyun.com/repository/public): /opt/software/apache-maven-3.8.6/ck/org/springframework/boot/spring-boot-starter-parent/2.3.2.RELEASE/spring-boot-starter-parent-2.3.2.RELEASE.pom.part.lock (No such file or directory) and 'parent.relativePath' points at no local POM @ line 6, column 13\n@\n[ERROR] The build could not read 1 project -> [Help 1]\n[ERROR]"),a("br"),n._v("\n[ERROR]   The project com.example:jenkins-test:0.0.1-SNAPSHOT (/var/jenkins_home/workspace/jenkins-test/pom.xml) has 1 error\n[ERROR]     Non-resolvable parent POM for com.example:jenkins-test:0.0.1-SNAPSHOT: Could not transfer artifact org.springframework.boot:spring-boot-starter-parent:pom:2.3.2.RELEASE from/to aliyunmaven (https://maven.aliyun.com/repository/public): /opt/software/apache-maven-3.8.6/ck/org/springframework/boot/spring-boot-starter-parent/2.3.2.RELEASE/spring-boot-starter-parent-2.3.2.RELEASE.pom.part.lock (No such file or directory) and 'parent.relativePath' points at no local POM @ line 6, column 13 -> [Help 2]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/ProjectBuildingException\n[ERROR] [Help 2] http://cwiki.apache.org/confluence/display/MAVEN/UnresolvableModelException\nBuild step 'Invoke top-level Maven targets' marked build as failure\nFinished: FAILURE")]),n._v(" "),a("p",[n._v('解决方案\n#递归修改文件的权限必须要加参数"-R"\nsudo chmod -R 777 /opt/software/apache-maven-3.8.6')]),n._v(" "),a("h3",{attrs:{id:"报错信息-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#报错信息-2"}},[n._v("#")]),n._v(" 报错信息")]),n._v(" "),a("p",[n._v('Got permission denied while trying to connect to the Docker daemon socket at\nunix:///var/run/docker.sock: Post\n"http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/springboot/stop": dial unix\n/var/run/docker.sock: connect: permission denied')]),n._v(" "),a("p",[n._v("解决方案\nchmod a+rw /var/run/docker.sock")]),n._v(" "),a("h2",{attrs:{id:"五、安装mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、安装mysql"}},[n._v("#")]),n._v(" 五、安装MySQL")]),n._v(" "),a("p",[n._v("docker run "),a("br"),n._v("\n-p 3306:3306 "),a("br"),n._v("\n--name mysql "),a("br"),n._v("\n-v ~/mysql/data:/var/lib/mysql "),a("br"),n._v("\n-e MYSQL_ROOT_PASSWORD=root "),a("br"),n._v("\n-d mysql")])])}),[],!1,null,null,null);s.default=e.exports}}]);